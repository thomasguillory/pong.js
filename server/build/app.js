// Generated by CoffeeScript 1.7.1
(function() {
  var Game, games, io, server;

  io = require('socket.io');

  Game = require('./models/game.js').Game;

  games = [];

  server = io.listen(5000);

  server.on('connection', function(socket) {
    var game;
    game = null;
    socket.on('join', function(uuid) {
      console.log('New join !');
      games[uuid] || (games[uuid] = new Game(uuid));
      game || (game = games[uuid]);
      return game.addParticipant(socket);
    });
    return socket.on('disconnect', function() {
      if (game != null) {
        game.removeParticipant(socket);
        if (!game.hasParticipants()) {
          game.stop();
          delete games[game.uuid];
          return game = null;
        }
      }
    });
  });

}).call(this);
